\clearpage

\subsubsection{Nodo de borde (concentrador)}
El objetivo de este nodo es poder recolectar los datos enviados a través de LoRa por los diferentes sensores, procesar los mismos y enviar la información al cloud para que esté disponible en la aplicación.

Para la elección como unidad de procesamiento, tuvimos en cuenta que los datos a ser procesados deben ser en tiempo real y con el mínimo tiempo de delay. Por lo cual el dispositivo de borde debía tener la capacidad de poder manejar esta carga. Dado que el equipo ya contaba con un mini ordenador utilizado ampliamente en la comunidad para prototipado (Raspberry Pi), hicimos pruebas de campo con resultados aceptables y decidimos utilizar el mismo para nuestro proyecto.

\insertimage[\label{raspberry_pi}]{secciones/section_4/images/raspberry_pi}{width=18cm}{Raspberry Pi 3 Model B+}

Como se puede apreciar en la figura anterior, Raspberry Pi es un mini ordenador, cuyo diseño de hardware es libre y cuenta con el sistema operativo GNU/Linux como Raspbian (aunque pueden utilizarse otros sistemas operativos basados en Linux como el caso de Ubuntu Server como ejemplo). 


Raspberry Pi utiliza una arquitectura de procesador ARM distinta a la que estamos acostumbrados a utilizar en nuestros ordenadores. Esta arquitectura es de tipo RISC (Reduced Instruction Set Computer), es decir, utiliza un sistema set de instrucciones realmente simple lo que le permite ejecutar tareas con un mínimo consumo de energía.

Además de lo mencionado anteriormente, este mini ordenador cuenta con salidas GPIO (General Purpose Input/Output - Entrada/Salida de Propósito General) lo que nos permite a través de la implementación del protocolo SPI poder dotar a la placa de comunicación LoRa. Y como esta cuenta con un chipset de WiFi integrado, resuelve el manejo y conexión a internet lo que nos habilita la integración con el backend de una forma sencilla.


\subsubsubsection{Sistema Operativo}
Raspberry Pi OS, previamente conocido como Raspbian, es el sistema operativo oficial diseñado específicamente para el microordenador Raspberry Pi. Esta distribución de Linux se basa en Debian y proporciona todo lo necesario para aprovechar al máximo esta placa. Está optimizado para funcionar en equipos ARM y viene con una amplia variedad de paquetes y programas preinstalados. Raspberry Pi OS utiliza el entorno de escritorio PIXEL (Pi Improved X-Window Environment, Lightweight), basado en LXDE, que es ligero y fácil de usar.

Existen tres ediciones diferentes de esta distribución:

\begin{itemize}
    \item Edición Completa: Incluye el escritorio PIXEL y una amplia selección de programas recomendados para comenzar a usar la distribución desde el primer momento.
    \item Edición Estándar: Incluye el escritorio y los programas básicos, sin ningún software recomendado adicional.
    \item Edición Lite: Es una imagen mínima basada en Debian que ocupa tan solo 400 MB. Esta edición incluye solo lo necesario para arrancar el dispositivo, dejando al usuario la responsabilidad de instalar los programas que necesite.
\end{itemize}

\subsubsubsection{PinOut}
A continuación se visualiza el pinout de la placa Raspberry Pi 3 Model B+:

\insertimage[\label{raspberry_pi_pinout}]{secciones/section_4/images/raspberry_pi_pinout}{width=18cm}{Pin Out - Raspberry Pi 3 Model B+}

Dado que nuestra Raspberry Pi 3 debe recibir y enviar mensajes a través de LoRa, se presenta a continuación el diagrama de conexión entre la Raspberry Pi y la placa Heltec. Para lograr esta comunicación, se utilizará el protocolo SPI (Interfaz Periférica en Serie) entre ambas placas:

\insertimage[\label{concentrator_schematic}]{secciones/section_4/images/concentrator_schematic}{width=17cm}{Conexión entre la Raspberry Pi y el módulo LoRa}

\subsubsubsection{Software}
Hemos creado una aplicación web de fácil uso que posibilita la configuración inicial del dispositivo. Esta configuración abarca aspectos como la conexión a la red WiFi, credenciales y parámetros de transmisión y recepción (Tx, Rx) LoRa.

Luego de la configuración inicial, el sistema queda listo para comenzar a recibir y procesar los datos obtenidos por los sensores. El código completo se encuentra disponible en el repositorio de github del proyecto, y a continuación ponemos la estructura principal que permite mostrar el funcionamiento básico del sistema.

A grandes rasgos podemos visualizar el diagrama de flujo de funcionamiento del software que corre la Raspberry Pi.

\insertimage[\label{nodo_colector_diagrama_flujos}]{secciones/section_4/images/nodo_colector_diagrama_flujos}{width=16cm}{Diagrama de flujos código concentrador}